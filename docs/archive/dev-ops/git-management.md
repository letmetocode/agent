# Git 管理规范（开发阶段）

## 1. 目标

- 保证每次变更可追溯、可回滚、可评审。
- 降低“巨型提交”与“噪音提交”带来的维护成本。
- 在开发阶段优先支持快速迭代，同时保持长期可维护性。

## 2. 核心原则

### 2.1 提交粒度

不是“每改一行都提交”，而是：

- 每完成一个**可独立回滚**的最小变更单元（原子变更）就提交一次。
- 一次 commit 只做一件事，避免混入无关改动。

原子变更的判断标准：

- 目标单一（例如：补一个 API、修一个并发 bug、补一组测试）。
- 文件改动围绕同一主题。
- 该提交可独立通过最小验证（编译或目标回归）。
- 单独回滚不会破坏主链路。

### 2.2 分支策略

- `main`：稳定主干。
- `feature/*`：功能开发。
- `fix/*`：缺陷修复。
- `chore/*`：工程维护。

### 2.3 提交信息规范

提交信息统一使用：

- `feature：...`
- `fix：...`
- `refactor：...`
- `test：...`
- `docs：...`
- `chore：...`

> 支持中文全角冒号 `：` 与英文冒号 `:`。

## 3. 标准流程（建议）

1. 从 `main` 创建功能分支。
2. 开发时按原子变更分批提交。
3. 提交前执行最小回归测试。
4. 发起 PR，说明目标、关键改动、测试结果。
5. 合并后删除分支。

## 4. 提交前检查清单

- 改动目标是否单一。
- 是否包含对应测试或回归说明。
- 是否同步文档（README + design + 配置注释）。
- `git diff --cached` 是否无无关文件。
- 是否包含运行产物（日志、dist、node_modules、临时文件）。

## 5. 本仓库本地 Hook 机制

仓库内置 `.githooks/`：

- `pre-commit`：阻止提交常见运行产物/日志产物。
- `commit-msg`：校验提交信息前缀格式。

安装（每台机器一次）：

```bash
bash scripts/setup-git-hooks.sh
```

## 6. 大改动提交策略

若一次需求跨度很大，建议拆分为 2~5 个阶段提交：

- 提交 1：数据模型与仓储
- 提交 2：服务与流程逻辑
- 提交 3：接口层
- 提交 4：测试
- 提交 5：文档与运维说明

> 这样可以显著降低评审与回滚成本。
