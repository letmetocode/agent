#!/usr/bin/env bash
set -euo pipefail

staged_files="$(git diff --cached --name-only --diff-filter=ACMR)"
if [[ -z "$staged_files" ]]; then
  exit 0
fi

for file in $staged_files; do
  case "$file" in
    data/log/*|agent-app/data/*|*.log|*.tmp|*.swp|*.swo|*~)
      echo "[pre-commit] 检测到运行时或临时文件：$file"
      echo "请先移除该文件再提交。"
      exit 1
      ;;
    frontend/node_modules/*|frontend/dist/*|frontend/*.tsbuildinfo)
      echo "[pre-commit] 检测到前端构建/依赖产物：$file"
      echo "请先移除该文件再提交。"
      exit 1
      ;;
  esac
done

exit 0
